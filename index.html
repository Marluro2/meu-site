<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TEORIAS DA APRENDIZAGEM - PPGECT - Doutorado </title>
  <meta name="description" content="PÃ¡gina oficial das atividades do Programa de Doutorado em CiÃªncias e Tecnologias." />
  <meta property="og:title" content="Atividades do Programa de Doutorado" />
  <meta property="og:description" content="PÃ¡gina oficial das atividades do Programa de Doutorado em CiÃªncias e Tecnologias." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="./img/capa_ppgect.png" />
  <meta property="og:url" content="." />

  <link rel="icon" href="./img/favicon.png" type="image/png" />
  <style>
    :root{
      --bg:#0f172a;
      --card:#111827;
      --muted:#9ca3af;
      --text:#f3f4f6;
      --accent:#22d3ee;
      --tag:#1f2937;
      --tag-text:#e5e7eb;
      --border:#1f2937;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial}
    header{
      display:flex;align-items:center;gap:16px;
      padding:20px 16px;border-bottom:1px solid var(--border);
      position:sticky;top:0;background:linear-gradient(180deg,rgba(15,23,42,.95),rgba(15,23,42,.85));
      backdrop-filter:saturate(150%) blur(6px); z-index:10;
    }
    header img{width:52px;height:52px;border-radius:12px;border:1px solid var(--border);object-fit:cover}
    header .titles{display:flex;flex-direction:column}
    header .titles h1{margin:0;font-size:1.1rem;line-height:1.2}
    header .titles span{font-size:.9rem;color:var(--muted)}
    header .meta {margin-left:auto;display:flex;gap:12px;align-items:center}
    header .meta .pill{
      border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:.85rem;color:var(--muted);
      display:flex;align-items:center;gap:6px;
    }
    header input[type="search"]{
      width:340px;max-width:50vw;background:#0b1220;color:var(--text);
      border:1px solid var(--border);border-radius:10px;padding:10px 12px;outline:none;
    }
    main{padding:24px;max-width:1100px;margin:0 auto}
    #mensagem{display:none;margin:24px 0;color:var(--muted)}
    .grid{
      display:grid;gap:16px;
      grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
    }
    .card{
      background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;
      display:flex;flex-direction:column;gap:10px;min-height:160px;
      transition:transform .12s ease, border-color .12s ease;
    }
    .card:hover{transform:translateY(-2px);border-color:#334155}
    .card h3{margin:0 0 4px 0;font-size:1rem}
    .card p{margin:0;color:var(--muted);font-size:.95rem}
    .card .meta{display:flex;align-items:center;flex-wrap:wrap;gap:8px}
    .date{font-size:.8rem;color:var(--muted);border:1px dashed var(--border);border-radius:8px;padding:2px 8px}
    .tag{background:var(--tag);color:var(--tag-text);font-size:.75rem;border-radius:999px;padding:3px 8px;border:1px solid var(--border)}
    .card a{
      margin-top:auto;align-self:flex-start;text-decoration:none;color:#0ea5e9;
      border:1px solid #1f2937;border-radius:8px;padding:8px 10px
    }
    footer{
      margin-top:28px;padding:18px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;color:var(--muted)
    }
    .visitas{font-variant-numeric:tabular-nums}
    @media (max-width:720px){
      header{flex-wrap:wrap}
      header input[type="search"]{width:100%;max-width:100%}
      .meta{width:100%}
    }
  </style>
</head>
<body>
  <header>
    <img src="./img/logo_ifsp.png" alt="IFSP" />
    <div class="titles">
      <h1>PPGECT â€” Atividades / Teorias da Aprendizagem</h1>
      <span>Doutorado â€¢ UTFPR â€¢ <span id="ano"></span></span>
    </div>

    <div class="meta">
      <span class="pill visitas" id="visitas">ðŸ‘€ Visitantes: <span id="visitas-num">â€”</span></span>
      <input id="q" type="search" placeholder="Pesquisar por tÃ­tulo, descriÃ§Ã£o ou tagâ€¦" />
    </div>
  </header>

  <main>
    <div id="mensagem">Carregandoâ€¦</div>
    <div id="lista" class="grid">
      <!-- Os cartÃµes serÃ£o renderizados via JS -->
    </div>
  </main>

  <footer>
    <small>Â© <span id="ano"></span> PPGECT â€” Doutorado (UTFPR) â€¢ PÃ¡gina do MÃ¡rcio</small>
    <small>Build estÃ¡tico â€¢ docs.json</small>
  </footer>

  <!-- Bloco ÃšNICO de script com contador robusto (CountAPI + fallback hits.sh) -->
  <script>
    document.getElementById('ano').textContent = new Date().getFullYear();

    let dados = [];

    function render(itens){
      const lista = document.getElementById('lista');
      if(!Array.isArray(itens) || itens.length===0){
        lista.innerHTML = '';
        const msgEl = document.getElementById('mensagem');
        if (msgEl) {
          msgEl.style.display='block';
          msgEl.textContent = 'Nenhum item encontrado.';
        }
        return;
      }
      const msgEl = document.getElementById('mensagem');
      if (msgEl) msgEl.style.display='none';
      lista.innerHTML = itens.map(it => `
        <div class="card">
          <h3>${it.titulo || 'Sem tÃ­tulo'}</h3>
          <p>${it.descricao || ''}</p>
          <div class="meta">
            ${it.data ? `<span class="date">${new Date(it.data).toLocaleDateString('pt-BR')}</span>`:''}
            ${(it.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('')}
          </div>
          <a href="${it.url}" target="_self" rel="noopener">Abrir</a>
        </div>
      `).join('');
    }

    function filtrar(q){
      q = (q||'').trim().toLowerCase();
      if(!q){ render(dados); return; }
      const fil = dados.filter(it => {
        const base = [
          it.titulo||'',
          it.descricao||'',
          (it.tags||[]).join(' ')
        ].join(' ').toLowerCase();
        return base.includes(q);
      });
      render(fil);
    }

    async function carregar(){
      const msg = document.getElementById('mensagem');
      try{
        const res = await fetch('./docs.json', {cache:'no-store'});
        if(!res.ok) throw new Error('docs.json nÃ£o encontrado');
        const itens = await res.json();
        dados = Array.isArray(itens) ? itens.slice() : [];
        dados.sort((a,b)=> (b.data||'').localeCompare(a.data||''));
        render(dados);
      }catch(e){
        if (msg) {
          msg.style.display='block';
          msg.textContent = 'NÃ£o foi possÃ­vel carregar docs.json. Coloque o arquivo na raiz do repositÃ³rio.';
        }
        console.error(e);
      }
    }

    const qEl = document.getElementById('q');
    if (qEl) qEl.addEventListener('input', e=> filtrar(e.target.value));
    carregar();

    // === Contador de visitas ===
    function setBadgeFallback(){
      // Fallback sem JS/CORS usando badge do hits.sh (conta requisiÃ§Ãµes de imagem)
      const el = document.getElementById('visitas');
      if(!el) return;
      el.innerHTML = 'ðŸ‘€ Visitantes: <img src="https://hits.sh/marcioluciorodrigues.com.br.svg?view=total" alt="Visitantes totais" style="height:16px;vertical-align:middle" referrerpolicy="no-referrer-when-downgrade" />';
    }

    async function contadorVisitas(){
      try{
        const ns  = 'ppgect-site';   // namespace estÃ¡vel
        const key = 'home';          // chave fixa estÃ¡vel
        const url = 'https://api.countapi.xyz/hit/' +
                    encodeURIComponent(ns) + '/' +
                    encodeURIComponent(key);
        const res  = await fetch(url, {cache:'no-store', mode:'cors'});
        if(!res.ok) throw new Error('CountAPI HTTP ' + res.status);
        const data = await res.json();
        const num  = (data && typeof data.value === 'number') ? data.value : null;
        const tgt  = document.getElementById('visitas-num');
        if (tgt && num !== null){
          tgt.textContent = num.toLocaleString('pt-BR');
        }else{
          setBadgeFallback();
        }
      }catch(err){
        console.error('contadorVisitas falhou:', err);
        setBadgeFallback();
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', contadorVisitas, {once:true});
    } else {
      contadorVisitas();
    }
  </script>
</body>
</html>
